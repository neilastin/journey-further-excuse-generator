# Not My Fault - Project Context

This document provides comprehensive context about the "Not My Fault" application for brainstorming and discussion purposes.

---

## 1. Project Overview

### What It Is
"Not My Fault" is a humorous web application that generates creative excuses for awkward situations using AI. Users describe what happened and who they need to explain it to, then receive three distinctly different excuses: a technical/formal one, a believable one, and an outrageous one.

### Target Audience
Anyone who needs a laugh or creative inspiration when explaining away unfortunate situations. The tone is lighthearted and comedic - this is entertainment, not actual advice.

### Tone & Personality
- **Sarcastic and self-aware**: The app knows it's ridiculous
- **British humour**: Dry, witty, slightly cynical
- **Playfully irresponsible**: Taglines like "Accountability is overrated" and "Correlation isn't causation"
- **Professionally presented absurdity**: Polished UI presenting ridiculous content

### Use Case
Entertainment and comedy. Users input embarrassing or awkward scenarios (missing meetings, forgetting anniversaries, etc.) and get AI-generated excuses tailored to their audience (boss, partner, friend, etc.).

---

## 2. Current Implementation Status

### Completed (Phase 1-3)
- Full React + TypeScript + Vite frontend
- Complete UI with all components built and working
- Tailwind CSS v4 dark theme with neon accents
- Claude API integration for excuse generation (2 excuses per request)
- Custom local development server with API proxy
- Form validation and error handling
- Loading animations with rotating messages
- Responsive design
- **Excuse generation fully functional with 8 comedic styles**
- **Phase 3 (2025-10-27): Comedic Style System & Image Preview Modal**
  - 8 comedic styles with random rotation (Absurdist, Observational, Deadpan, Hyperbolic, Self-deprecating, Ironic, Meta, Paranoid)
  - Image generation with style matching (8 visual styles aligned with excuse humor)
  - Headshot upload support (withHeadshot/withoutHeadshot variants)
  - Full-screen image preview modal with download functionality
  - Auto-close after download with visual feedback
  - Strengthened NO TEXT rules in image generation
  - Explicit people rules preventing unwanted subjects

### Not Yet Implemented
- Production deployment to Vercel
- Analytics/tracking
- Rate limiting
- User authentication (optional)

### Current Phase
**Phase 3 Complete** - Ready for Phase 4 (Testing & Quality Assurance) or Phase 5 (Deployment)

---

## 3. Tech Stack

### Frontend
- **React 18.3.1** - UI framework
- **TypeScript 5.6.2** - Type safety
- **Vite 6.0.5** - Build tool and dev server
- **Tailwind CSS 4.1.14** - Styling (v4 uses `@theme` in CSS, not JS config)
- **Framer Motion 12.23.24** - Animations
- **lucide-react 0.545.0** - Icons

### Backend/Serverless
- **Vercel Serverless Functions** - API endpoints in `/api` directory
- **Custom dev server** (`dev-server.js`) - Local development API server on port 3001
- **tsx 4.20.6** - TypeScript execution for dev server
- **concurrently 9.2.1** - Run both Vite and API server together

### AI APIs
- **Anthropic Claude API** (Sonnet 4) - Excuse generation (working)
- **Google Gemini API** - Image generation (planned, not implemented)

### Deployment
- **Vercel** - Hosting platform (not yet deployed)
- **@vercel/node 5.3.26** - Serverless function runtime

---

## 4. Key Features

### Excuse Generation
Three excuse types generated simultaneously:
1. **Technical/Formal** - Overly complicated, academic, uses jargon (blue accent)
2. **Believable** - Reasonable, mundane, straightforward (purple accent)
3. **Outrageous** - Absurd, far-fetched, entertaining (green accent, special gradient border)

Each excuse includes:
- A randomly selected title from a pool of 20 per category (60 total)
- The excuse text generated by Claude API
- Color-coded accent styling

### Random Tagline System
20 unique tagline variations that change personality on each page load:
- Two-line taglines in hero section
- Matching form labels that maintain tone consistency
- Different placeholder examples for each variation

Examples:
- "Bad things happen. You get blamed." → Form asks "Who's blaming you?"
- "Accountability is overrated." → Form asks "Who wants accountability?"
- "Plausible deniability is an art form." → Form asks "Who are you explaining to?"

### Tabbed Interface
Instead of showing 3 excuses side-by-side, uses tabs to switch between excuse types:
- Better mobile experience
- Focused attention on one excuse at a time
- Smooth animations when switching tabs
- "Outrageous" tab has special gradient border with pulse animation

### Dynamic Randomized Titles
60 pre-written titles (20 per excuse type) randomly assigned:
- **Technical**: "The Quantum Explanation", "The Peer-Reviewed Story", "The Algorithm's Verdict"
- **Believable**: "The Safe Bet", "The Rational Response", "The Solid Alibi"
- **Outrageous**: "The Conspiracy Theory", "The Multiverse Incident", "The Time Traveler's Log"

### Loading Experience
55 rotating loading messages that cycle during excuse generation:
- "Consulting the excuse archives..."
- "Fabricating plausible deniability..."
- "Summoning the excuse muse..."
- Changes every 2 seconds to keep users entertained

---

## 5. Architecture Details

### Component Structure
```
src/
├── components/
│   ├── Header.tsx           - Navigation with logo
│   ├── Hero.tsx             - Title + dynamic tagline
│   ├── ExcuseForm.tsx       - User input form (scenario + audience)
│   ├── ExcuseCards.tsx      - Tab navigation + excuse display
│   ├── ExcuseCard.tsx       - Individual excuse card component
│   ├── LoadingAnimation.tsx - Rotating loading messages
│   └── ErrorMessage.tsx     - Error display
├── lib/
│   ├── constants.ts         - Excuse titles, loading messages, audience options
│   ├── taglineVariations.ts - 20 tagline variations with form labels
│   └── utils.ts             - cn() helper for Tailwind classes
├── types/
│   └── index.ts             - TypeScript interfaces
├── App.tsx                  - Main app orchestration
├── main.tsx                 - React entry point
└── index.css                - Tailwind v4 theme with @theme directive
```

### Random Variation System
On component mount, `App.tsx` selects one random `TaglineVariation`:
```typescript
const [variation] = useState<TaglineVariation>(() => getRandomVariation());
```

This variation is passed down to:
- `Hero` - displays the tagline
- `ExcuseForm` - uses matching form labels and placeholder

Result: Perfect tone consistency from tagline through form submission.

### API Flow
1. **Frontend** → User fills form → Submit button clicked
2. **Vite Proxy** → `/api/generate-excuses` proxied to dev server (localhost:3001)
3. **Dev Server** → Loads `.env.local` → Injects `ANTHROPIC_API_KEY` into process.env
4. **Serverless Function** (`api/generate-excuses.ts`) → Calls Claude API
5. **Claude API** → Returns 3 excuses as JSON
6. **Frontend** → Displays excuses in tabbed interface

### File Organization
- `/api` - Serverless functions (Vercel Edge Functions in production)
- `/src/components` - React components (all presentational)
- `/src/lib` - Utilities, constants, helpers
- `/src/types` - TypeScript interfaces
- `dev-server.js` - Custom local API server (root level)
- `.env.local` - API keys (gitignored, must create locally)

---

## 6. Design Decisions

### Why Tabbed Interface Instead of 3 Columns?
**Original design**: 3-column grid showing all excuses simultaneously.

**Changed to tabs because**:
1. **Mobile responsiveness** - 3 columns cramped on mobile, tabs work perfectly
2. **Focus** - One excuse at a time reduces cognitive load
3. **Comparison** - Users can easily switch between types to compare
4. **Animation opportunities** - Smooth transitions between tabs feel polished
5. **Hierarchy** - "Believable" defaults, making it the recommended choice

### Why Remove "Importance" Field?
**Original design**: Users could rate urgency (Low/Medium/High/Critical).

**Removed because**:
1. **Unnecessary complexity** - Didn't significantly affect excuse quality
2. **Cognitive load** - One less decision for users
3. **Form flow** - Two fields (scenario + audience) is cleaner than three
4. **API simplicity** - Claude doesn't need urgency level to generate good excuses

### Why British English?
Matches the dry, sarcastic tone:
- "Whilst" instead of "while"
- "Apologise" instead of "apologize"
- "Defence" instead of "defense"
- Fits the sophisticated absurdity aesthetic

### Tone Consistency Strategy
**Problem**: Random taglines felt disconnected from form labels.

**Solution**: Created `TaglineVariation` interface that bundles:
- Tagline text (2 lines)
- Form labels (situation label + audience label)
- Placeholder example

Example consistency:
```
Tagline: "Plausible deniability is an art form. Consider us your personal gallery."
Form: "What happened?" + "Who are you explaining to?"
Placeholder: "I didn't see any of the 23 text messages about collecting my mother-in-law"
```

All 20 variations maintain this tight coupling between tagline tone and form language.

---

## 7. Recent Changes

### Tabbed Interface Redesign
**Commit**: Major UI overhaul (January 2025)
- Changed from 3-column grid to single card with tab navigation
- Added tab buttons with active state styling
- Implemented smooth animations with Framer Motion
- Special gradient border for "Outrageous" tab with pulse effect
- "Believable" excuse defaults as active tab

### Dynamic Tagline/Form Label Implementation
**Commit**: Tone consistency improvement
- Created `taglineVariations.ts` with 20 complete variations
- Each variation bundles tagline + form labels + placeholder
- Random variation selected on mount, passed to Hero and ExcuseForm
- Perfect tone matching throughout user journey

### Spacing Improvements
- Reduced vertical spacing in hero section (`py-8 md:py-12` instead of `py-16 md:py-24`)
- Improved mobile padding (`px-mobile md:px-desktop`)
- Better form-to-results spacing (`mt-12` on results section)

### Title Change
- Changed from "Craft the Perfect Excuse" to simply "Not My Fault"
- Shorter, punchier, more memorable
- Matches sarcastic tone better

### Excuse Title Randomization
- Added 60 pre-written titles (20 per category)
- `getRandomExcuseTitle()` function selects one per excuse type
- Titles assigned once when excuses load (via `useMemo`)
- Ensures variety without AI hallucination

---

## 8. Next Steps / Roadmap

### ✅ Phase 3: Image Generation Integration (COMPLETE - 2025-10-27)
1. ✅ Connected Gemini API in `/api/generate-image.ts`
2. ✅ Added image upload component for headshots (HeadshotUpload.tsx)
3. ✅ Generate excuse-themed images with 8 visual styles matching comedic styles
4. ✅ Display images with full-screen preview modal (ImageModal.tsx)
5. ✅ Add image download functionality with auto-close feedback

### Phase 4: Testing & Quality Assurance
1. Add more micro-interactions and animations
2. Improve mobile responsiveness edge cases
3. Add loading states for image generation
4. Implement better error handling (API rate limits, network issues)
5. Add copy-to-clipboard functionality for excuses
6. Test with various edge cases and long inputs

### Phase 5: Production Deployment
1. Create Vercel project
2. Configure environment variables in Vercel dashboard
3. Deploy and test production build
4. Set up custom domain (optional)
5. Configure analytics/monitoring

### Security Improvements Needed
1. Add rate limiting to prevent API abuse
2. Implement request validation middleware
3. Add CORS configuration for production
4. Consider adding authentication for production use
5. Monitor API costs and set usage limits

---

## 9. Technical Highlights

### Tailwind CSS v4 Configuration
**Key difference from v3**: Theme defined in CSS, not JavaScript.

`src/index.css` uses `@theme` directive:
```css
@import "tailwindcss";

@theme {
  --color-background: #0a0a0a;
  --color-accent-green: #00ff88;
  --radius-card: 12px;
  /* ... etc */
}
```

`tailwind.config.js` is minimal (only content paths):
```javascript
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}']
}
```

Classes used in components: `bg-background`, `text-accent-green`, `rounded-card`, etc.

### Custom Dev Server Setup
**Problem**: Vite can't run serverless functions locally + dotenv doesn't work with ES modules.

**Solution**: Custom `dev-server.js`:
1. Uses `dotenv` to parse `.env.local`
2. Manually injects values into `process.env`
3. Dynamically imports TypeScript serverless functions via `tsx`
4. Runs on port 3001
5. Vite proxies `/api/*` requests to this server

Run with: `npm run dev` (starts both Vite and API server via `concurrently`)

### Type Safety with TypeScript
Shared types in `src/types/index.ts`:
- `ExcuseItem` - Title + text structure
- `ExcusesResponse` - Three excuses from API
- `TaglineVariation` - Tagline + form labels bundle
- `AudienceOption` - Dropdown values

Components use strict typing for props and state.

### 60 Randomized Excuse Titles
20 titles per category (technical, believable, outrageous):
- Prevents repetition across multiple generations
- Maintains consistent style per category
- Selected randomly via `getRandomExcuseTitle(type)`
- Applied once when excuses load (not regenerated on tab switch)

### 20 Tagline Variations
Each variation maintains tone consistency:
```typescript
interface TaglineVariation {
  tagline: { line1: string; line2: string };
  formLabels: {
    situation: string;
    audience: string;
    placeholder: string;
  };
}
```

Selected once on mount, used throughout session.

---

## 10. Files and Structure

### Key Files Overview

#### `/src/App.tsx` (Main orchestrator)
- Manages all application state (excuses, loading, errors, variation)
- Coordinates data flow between components
- Handles API calls to `/api/generate-excuses`

#### `/src/components/ExcuseForm.tsx` (User input)
- Two fields: scenario (textarea) and audience (dropdown)
- Validation: minimum 10 characters for scenario
- Dynamic labels based on current tagline variation
- Disabled during loading state

#### `/src/components/ExcuseCards.tsx` (Results display)
- Tabs for switching between excuse types
- Single card display with animations
- Assigns random titles from constants
- Special styling for "Outrageous" tab (gradient border + pulse)

#### `/src/components/Hero.tsx` (Landing hero)
- Displays "Not My Fault" title
- Shows dynamic tagline (2 lines) from current variation
- Responsive text sizing

#### `/src/lib/taglineVariations.ts` (Tone consistency)
- 20 complete variations
- Each bundles tagline + form labels + placeholder
- `getRandomVariation()` function for random selection

#### `/src/lib/constants.ts` (Static data)
- 60 excuse titles (20 per type)
- 55 loading messages
- 10 audience options
- Animation timing constants
- `getRandomExcuseTitle()` function

#### `/api/generate-excuses.ts` (Claude API integration)
- Serverless function (Vercel Edge Function)
- Validates inputs (scenario, audience)
- Constructs detailed prompt for Claude
- Parses JSON response
- Returns 3 excuses with titles and text
- Includes error handling and timeout protection

#### `dev-server.js` (Local API server)
- Loads `.env.local` using dotenv
- Injects env vars into `process.env`
- Serves serverless functions on port 3001
- Handles TypeScript files via tsx

#### `/src/types/index.ts` (Type definitions)
- `ExcuseItem`, `ExcusesResponse` - API response types
- `TaglineVariation` - Tagline + form bundle
- `AudienceOption` - Dropdown type
- Component prop interfaces

#### `/src/index.css` (Theme definition)
- Tailwind v4 `@theme` directive
- Dark background (#0a0a0a) with neon accents
- Custom CSS utilities (outrageous tab gradient border)
- Base styles and resets

---

## Usage Tips for Brainstorming

When discussing features, UX, or architecture:

1. **Tone is crucial** - Any new features should maintain the sarcastic, self-aware British humour
2. **Simplicity matters** - We removed "importance" field for good reason; avoid feature bloat
3. **Consistency is key** - Taglines and form labels must feel connected
4. **Mobile-first** - Tabbed interface was chosen for mobile; consider this for new features
5. **Performance** - Currently very fast; keep it that way (no heavy dependencies)
6. **Security** - API keys must never be exposed to frontend
7. **Comedy timing** - Loading messages, animations, and transitions all contribute to the experience

### Common Discussion Topics

**Image generation feature**: How to present AI-generated images? Thumbnail? Full-size? Download button? Should images be excuse-specific or generic?

**Shareable results**: How to implement sharing? URL with ID? Image export? Social media cards?

**Copy functionality**: Should excuses be copyable? One-click? Show "Copied!" feedback?

**Audience customization**: Should we allow freeform audience input instead of dropdown? Pros/cons?

**Excuse refinement**: Should users be able to regenerate or tweak excuses? Or is one-shot better for comedy timing?

**Analytics**: What metrics matter? Number of generations? Popular audiences? Excuse type preferences?

---

## Example Scenarios

Here are realistic scenarios that demonstrate the app's tone:

1. **Scenario**: "I missed the quarterly presentation that my boss spent three weeks preparing for"
   **Audience**: "My manager"
   **Result**: Technical ("The Temporal Coordination Failure"), Believable ("Calendar Sync Issue"), Outrageous ("The Great Calendar Conspiracy")

2. **Scenario**: "I completely forgot about our 10-year wedding anniversary dinner reservation"
   **Audience**: "My partner"
   **Result**: Technical ("A Cognitive Processing Error"), Believable ("Work Crisis"), Outrageous ("Alien Abduction Incident")

3. **Scenario**: "I accidentally deleted the only backup copy of five years of company financial records"
   **Audience**: "A client"
   **Result**: Technical ("Quantum Data Decoherence"), Believable ("Software Update Gone Wrong"), Outrageous ("The Server Gained Sentience")

---

## British English Examples

For maintaining tone consistency in new content:

- "apologise" not "apologize"
- "defence" not "defense"
- "whilst" not "while"
- "towards" not "toward"
- "amongst" not "among"
- "colour" not "color"
- "favour" not "favor"
- "realise" not "realize"

Also use British phrasing:
- "having a laugh" not "having fun"
- "spot on" not "exactly right"
- "sorted" not "fixed"
- "proper" as emphasis ("proper excuse")
- "brilliant" not "awesome"

---

## Current Known Limitations

1. ~~**No image generation yet**~~ - ✅ IMPLEMENTED (Phase 3)
2. **No excuse persistence** - Excuses disappear on refresh (could add local storage)
3. **No sharing functionality** - Can't easily share excuses with others
4. ~~**No copy button**~~ - ✅ IMPLEMENTED (copy button exists in ExcuseCards)
5. **No regeneration** - Can't tweak excuses without re-submitting form
6. **Single language** - Only English (British), no internationalization
7. **No authentication** - Open to anyone, no user accounts
8. **No rate limiting** - Could be abused (needs implementation before production)
9. **No production deployment yet** - Still in local development

---

This context should provide everything needed for productive brainstorming about features, UX improvements, architecture decisions, and future direction for "Not My Fault". The app is functional, polished, with Phase 3 (image generation with comedic style system) now complete. Ready for Phase 4 (Testing & QA) or Phase 5 (Production Deployment).
